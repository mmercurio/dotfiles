#!/usr/bin/env bash

set -eufo pipefail

{{ if stat "/opt/homebrew/bin/brew" -}}
eval "$(/opt/homebrew/bin/brew shellenv)"
{{ else if stat "/usr/local/bin/brew" -}}
eval "$(/usr/local/bin/brew shellenv)"
{{ end -}}


{{ $brews := list
     "automake"
     "awscli"
     "bash"
     "bash-completion2"
     "bat"
     "binutils"
     "curl"
     "dockutil"
     "diff-so-fancy"
     "findutils"
     "gawk"
     "gh"
     "git"
     "gnupg"
     "gnu-sed"
     "grep"
     "htop"
     "httpie"
     "imagemagick"
     "nb"
     "iperf3"
     "libffi"
     "libpq"
     "jq"
     "yq"
     "netcat"
     "pyenv"
     "pyenv-virtualenv"
     "readline"
     "ripgrep"
     "ruby-build"
     "shellcheck"
     "ssh-copy-id"
     "sshpass"
     "tesseract"
     "tmux"
     "wget"
	 "unzip"
	 "zip"
     "zlib" -}}
{{ $casks := list
     "alfred"
     "cryptomator"
     "flux-app"
     "finicky"
     "brave-browser"
     "fantastical"
     "cardhop"
     "google-chrome"
     "iterm2"
     "monitorcontrol"
     "1password-cli"
     "signal"
     "slack"
     "visual-studio-code"
     "wezterm" -}}

{{ if eq .chezmoi.arch "amd64" -}}
{{   $brews = concat $brews (list
       "shellcheck") -}}
{{ end -}}

brew bundle --file=/dev/stdin <<EOF
{{ range ($brews | sortAlpha | uniq) -}}
brew "{{ . }}"
{{ end -}}
{{ if .brewcasks }}
{{   range ($casks | sortAlpha | uniq) -}}
cask "{{ . }}"
{{   end }}
{{ end -}}
EOF

brew install --cask AlexStrNik/Browserino/browserino
